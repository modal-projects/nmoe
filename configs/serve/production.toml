# nmoe.serve production configuration
# Usage: python -m nmoe.serve.launch --config configs/serve/production.toml

# Model (use env var for path portability)
model_path = "${NMOE_MODEL_PATH}"
model_family = "deepseek"

# Scheduling
max_batch_size = 256
max_prefill_tokens = 8192
max_seq_len = 32768

# Memory
gpu_memory_utilization = 0.9
num_pages = 8192

# KV cache layout (DeepSeek-V3 MLA defaults)
[kv_layout]
kv_lora_rank = 512
qk_rope_head_dim = 64
num_layers = 61
page_size = 64

# Replica configuration (8 GPUs, single "both" replica for EP=8)
[[replicas]]
replica_id = 0
gpus = [0, 1, 2, 3, 4, 5, 6, 7]
role = "both"

# API server
host = "0.0.0.0"
port = 8000
metrics_port = 9090
